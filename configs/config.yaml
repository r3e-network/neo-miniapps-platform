# Sample configuration for the refactored Service Layer runtime.
# All sections are optional â€“ omit what you do not need.

server:
  host: "0.0.0.0"
  port: 8080

database:
  # When dsn is empty the runtime falls back to in-memory storage.
  driver: "postgres"
  dsn: "postgres://service_layer:service_layer@localhost:5432/service_layer?sslmode=disable"
  max_open_conns: 10
  max_idle_conns: 5
  conn_max_lifetime: 300

logging:
  level: "info"   # debug, info, warn, error
  format: "text"  # text, json
  output: "stdout"
  file_prefix: "service-layer"

runtime:
  tee:
    # Controls which executor backend the function runtime uses ("mock" to
    # force the in-process mock TEE; any other value enables the enclave
    # executor wiring).
    mode: ""
  random:
    # Optional base64/hex encoded ed25519 private key for deterministic random
    # signatures. Leave empty to auto-generate ephemeral keys on startup.
    signing_key: ""
  pricefeed:
    # Configure the HTTP fetcher for refreshing price feeds. Leave fetch_url
    # empty to disable the refresher.
    fetch_url: ""
    fetch_key: ""
  gasbank:
    # Configure the asynchronous gas bank settlement poller. Leave resolver_url
    # empty to disable settlement polling.
    resolver_url: ""
    resolver_key: ""
    # Tuning knobs for settlement retries and polling cadence.
    poll_interval: "15s"
    max_attempts: 5
  oracle:
    # Optional TTL for oracle requests (seconds). Zero disables TTL expiry.
    ttl_seconds: 0
    # Maximum resolver attempts before DLQ.
    max_attempts: 3
    # Backoff between attempts (duration string).
    backoff: "10s"
    # Enable dead-lettering for exhausted/expired requests.
    dlq_enabled: true
    # Optional list of tokens required for runner callbacks (X-Oracle-Runner-Token).
    runner_tokens: []
  datafeeds:
    # Minimum signer threshold for feed definitions (0 to disable).
    min_signers: 0
    # Default aggregation strategy for submissions (median|mean|min|max).
    aggregation: "median"
  cre:
    # Set to true to enable the HTTP CRE runner.
    http_runner: false

auth:
  # Static bearer tokens accepted by the HTTP API. Combine with the
  # API_TOKENS / API_TOKEN environment variables for runtime overrides.
  tokens:
    - "dev-token"   # Local-only default; override in production.
  # JWT secret and users enable /auth/login for dashboard/console logins.
  jwt_secret: "change-me-jwt-secret"
  users:
    - username: "admin"
      password: "changeme"
      role: "admin"

security:
  # Secret encryption key used for vault storage. Required when using
  # persistent stores (e.g. PostgreSQL). Accepts raw, base64, or hex-encoded
  # 16/24/32 byte AES keys.
  secret_encryption_key: ""
